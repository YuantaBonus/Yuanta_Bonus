<!doctype>
<html>
	
<head><script src="deployment.js"></script>
	<meta charset="UTF-8">
	<title>Credit Rating on Ethereum</title>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<link type="text/css" rel="stylesheet" href="css/style.css"/>
</head>
<script type='text/javascript'>
	
	//web3.setProvider(new web3.providers.HttpProvider("http://localhost:8545"));
	web3.eth.defaultAccount = web3.eth.accounts[0];
	
	function addDeal(){
		var Baddress = document.getElementById('BuyerAddress').value;
		var Saddress = document.getElementById('SellerAddress').value;
		var res = contracts["CreditRating"].contract.addDeal(Baddress,Saddress);
	}
	
	function searchDeal(){
		var param = parseInt(document.getElementById("query").value);
        var res = contracts["CreditRating"].contract.deals(param);
		document.getElementById("dealresult_buyer").innerText = "buyer's address:\n" + res[1];
		document.getElementById("dealresult_seller").innerText = "seller's address:\n" + res[2];
	}
	
	function Rating(){
		var param = parseInt(document.getElementById("dealNum").value);
		if(isNaN(param)){
			alert("please type the deal's number");
			return;
		}
		var Rating = document.getElementById('form');
		for(var i = 0 ; i<Rating.rate.length; i++){
			if(Rating.rate[i].checked){
				if(Rating.rate.value==3)
					var res = contracts["CreditRating"].contract.goodrate(param);
				if(Rating.rate.value==2)
					var res = contracts["CreditRating"].contract.normalrate(param);
				if(Rating.rate.value==1)
					var res = contracts["CreditRating"].contract.badrate(param);
			}
		}
		if(!res)
				alert("please choose a rate to give");
	}
	
	function searchUser(){
		var param = document.getElementById("user").value;
        var res = contracts["CreditRating"].contract.users(param);
		
        document.getElementById("userresult_user").innerText = "User:\n" + res[0];
		document.getElementById("userresult_good").innerText = "\nRate:\ngood x " + res[1];
		document.getElementById("userresult_normal").innerText = "normal x " + res[2];
		document.getElementById("userresult_bad").innerText = "bad x " + res[3];
		document.getElementById("userresult_total").innerText = "\nTotal: "+ res[4];
	}
	
	
	function checkUserDeal(){
		var param = document.getElementById("userdeal").value;
        var res = contracts["CreditRating"].contract.checkUserDeal(param);
        document.getElementById("userdeal_user").innerText = "User:\n" + param;
		document.getElementById("userdeal_rated").innerText = "List of User's deal:\n" + res[0] + res[1];
	}

</script>
<body>
	
<div class="header">
	<h1>Credit Ratings</h1>
</div>
<div class="main">	
	<div class="part">
		<a>*Add Deal</a><br>
		<div class="padding">
			buyer's address:<input type='address' id='BuyerAddress'><br>
			seller's address:<input type='address' id='SellerAddress'><br>
			<button onclick='addDeal()'>Submit</button>
		</div>
	</div>
	<div class="part">
		<a>*Search Deal</a><br>
		<div class="padding">
		deal's number:<input type="number" id="query" onkeyup='searchDeal()'><br>
		<div id='dealresult_buyer'></div>
		<div id='dealresult_seller'></div>
		</div>
	</div>
	<div class="part">
		<a>*Rate the dealer</a><br>
		<div class="padding">
			deal's number:<input type='number' id='dealNum'><br>
			rate to give:<form id='form'><input type='radio' name='rate' id='rate' value='3'>good
								<input type='radio' name='rate' id='rate' value='2'>normal
			<input type='radio' name='rate' id='rate' value='1'>bad
			<br><button onclick='Rating()'>Submit</button></form>
		</div>
	</div>
	<div>
		<a>*Search User's Credit</a><br>
		<div class="padding">
			user's address:<input type="address" id="user" onkeyup='searchUser()'><br>
			<div id='userresult_user'></div>
			<div id='userresult_good'></div>
			<div id='userresult_normal'></div>
			<div id='userresult_bad'></div>
			<div id='userresult_total'></div>
		</div>		
	</div>
	<!-- <div class="part">
		<a>*Check User's deals</a><br>
		<div class="padding">
			user's address:<input type="address" id="userdeal"><br>
			<button onclick='checkUserDeal()'>Submit</button>
			<div id='userdeal_user'></div><br>
			<div id='userdeal_rated'></div>
		</div>	
	</div> -->
</div>
</body>
</html>
